---
layout: page
---

---

### II-2. Processing raw sequence reads

In this part, we will briefly learn how to understand the format of
FASTQ files, and how to align them using the `bwa` alignment software
tool.

---

#### a. Browse raw sequence reads

- The first task today is to read the example FASTQ files extracted
from the 1000 Genomes Project. Type the following command
> <pre>
zless ~/data/1000g/fastqs/HG00406.R1.fastq.gz </pre>
  * Q. What did appear in the screen? 
  * Q. Can you tell what is the base call and quality of the very
    first base of the first read?
  * Q. What happens if you press [Tab] in the middle of typing the
    file path?
  * Q. Why was `zless` used instead of `less`?
	
- Next, get a basic summary statistics on the FASTQ file using the
  following command
> <pre>
zcat ~/data/1000g/fastqs/HG00406.R1.fastq.gz | wc -l </pre>
  * Q. What did appear in the screen?
  * Q. What do you think the output means? 
  * Q. How many reads are contained in the FASTQ file?
  * Q. How many reads are contained in the other pairs, contained in
       `~/data/1000g/fastqs/HG00406.R2.fastq.gz`?
  
- Next, let's check whether the two paired FASTQ files have matching
  read names in each line, using the following command.
> <pre>
paste <(zcat ~/data/1000g/fastqs/HG00406.R1.fastq.gz) <(zcat ~/data/1000g/fastqs/HG00406.R2.fastq.gz) | less -S </pre>
   * Q. What do you see in the output?
   * Q. Can you explain what the command is doing?
   * Q. What is the difference between `less` and `less -S`?
   * Q. How can you verify that the FASTA files have matching read names down to the end of the file?	 
     * If you can't figure out the answer, feel free to __[open a clue](day1-clue-ii-a-1)__


---

#### b. Understand and access the reference genome

- Next, we will align the raw sequence reads in FASTQ format to the
  human reference genome using `bwa mem` software tool. To do so, we
  will use GRCh38 reference genome in FASTA format. Let's see what
  the FASTA-formatted file contains.
> <pre>
less ~/data/ref/hs38DH.fa </pre>
   * Q. What do you see in the first line? What do you think it
     represents?
   * Q. What do you see in the second line and after? What do you
     think it represents?
   * Q. Press space bar several times. What do you see?
   
- You can access the reference genome at an arbitrary location using
  `samtools faidx`. Try the following command:
> <pre>
samtools faidx ~/data/ref/hs38DH.fa chr20:10000000-10001000 </pre>
   * Q. What did the command do?
   * Q. To be able to randomly access the FASTA file, it has to be
   indexed first. Check whether the index file exists using the
   following command:
> <pre>
ls -l ~/data/ref/hs38DH.fa.fai </pre>
   * Q. The SNP `rs7903146`, located at chr10:114758349 in GRCh38, has
   two alleles. The risk allele is `T` and the protective allele is
   `C`. Does the reference genome carry risk or protective allele? A
   clue can be obtained by running the following command:
> <pre>
samtools faidx ~/data/ref/hs38DH.fa chr10:114758349-114758349 </pre>

---

#### c. Aligning raw sequence reads

- Now, we will align our example raw sequence reads in FASTQ format
  using `bwa mem` alignment software tool. The help page of `bwa mem`
  can be seen by running
> <pre>
bwa mem 2>&1 | less </pre>
  * Q. Did you understand how to use `bwa mem` software? What should
    be the input files and arguments?

- Next, we will align the example FASTQ file using the following command: 
> <pre>
bwa mem -t 2 -R '@RG\tID:HG00406_1KG_lowcov\tSM:HG00406\tLB:HG00406\tPL:ILLUMINA' \
~/data/ref/hs38DH.fa ~/data/1000g/fastqs/HG00406.R1.fastq.gz \
~/data/1000g/fastqs/HG00406.R2.fastq.gz -o HG00406.bwa.sam
  * Q. What does `-t 2` option stands for? 
  * Q. What is the purpose of the `-R` option? What would be the
    disadvantage(s) if we do not specify the option?
  * Q. To run `bwa mem`, the reference genome must be indexed using
    `bwa`. Can you identify which files are indices generated by `bwa
    mem` a priori?
> <pre>
ls -l  ~/data/ref/hs38DH.fa* </pre>

- The output SAM file can be viewed as a plain text file as follows:
> <pre>
less HG00406.bwa.sam </pre>

- Or viewing the header can be skipped if read with `samtools view`
without any option
> <pre>
samtools view HG00405.bwa.sam | less -S
  * Q. Can you tell which column represents which?
  * Q. Is the output SAM file sorted by genomic coordinate or not? How
    can you tell?
	
---

Feel free to ask questions to your instructor(s) if you are stuck. 
Otherwise, let's go to next step 
[II-3 Processing aligned sequence reads](../class-material/day1-bam-practice.html)
, or go back to [Day 1 Overview](../day1).

---
